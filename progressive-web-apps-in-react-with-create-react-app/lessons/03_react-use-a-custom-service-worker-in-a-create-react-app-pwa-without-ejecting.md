The most basic way to replace the default service worker is to make a new file in the public folder and we'll call that `my-service-worker.js`. That name could be anything you'd like, but the file must be in the root of the `public` folder, so that it can be served from the root of our application.

![image of the service worker file in the public folder](https://res.cloudinary.com/dg3gyk0gu/image/upload/v1544582324/transcript-images/react-use-a-custom-service-worker-in-a-create-react-app-pwa-without-ejecting-fileplacement.png)

Let's just add a `console.log` line here. 

#### public/my-service-worker.js
```js
console.log("Hello from my-service-worker!")
```

Then open `src/serviceWorker.js`. There we can find the old service worker file name and replace it with our new service worker file name.

#### src/serviceWorker.js
```js
 window.addEventListener('load', () => {
      const swUrl = `${process.env.PUBLIC_URL}/my-service-worker.js`;
```

Again, it's important that we serve from the root here because the service worker can only control the parts of the app that are at the same level or below the level that it's served from.

Then we can make a new production build and serve it and open it in Chrome. 

#### terminal
```bash
$ yarn build
```
```bash
$ serve -s build
```

![image of the application opened in chrome](https://res.cloudinary.com/dg3gyk0gu/image/upload/v1544582328/transcript-images/react-use-a-custom-service-worker-in-a-create-react-app-pwa-without-ejecting-chrome.png)

In the console tab we can see our "Hello" message, so we know the service worker is running. 

![image of the hello message in the console tab](https://res.cloudinary.com/dg3gyk0gu/image/upload/v1544582334/transcript-images/react-use-a-custom-service-worker-in-a-create-react-app-pwa-without-ejecting-consoletab.png)

Also, in the application tab of Chrome's DevTools we can see the new service worker file name. If we click on it we can see our custom service worker.

![image of the custom service worker](https://res.cloudinary.com/dg3gyk0gu/image/upload/v1544582339/transcript-images/react-use-a-custom-service-worker-in-a-create-react-app-pwa-without-ejecting-custom.png)

That's the easiest way to replace the service worker, but it totally bypasses Workbox, which has a lot of functionality that we want to take advantage of for this application. Let's revert back to the original file name and delete the custom service worker.

#### src/serviceWorker.js
```js
 window.addEventListener('load', () => {
      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;
```

In terminal `yarn add - D react-app-rewired`, which we can use to rewrite the webpack config without ejecting and take full advantage of Workbox. 

#### terminal
```bash
$ yarn add - D react-app-rewired
```

Make a new file called `config-overides.js` in the root of the project. We'll copy in the default function from the react-app-rewired's documentation.

#### config-overrides.js
```js
/* config-overrides.js */

module.exports = function override(config, env) {
  //do stuff with the webpack config...
  return config;
}
```

To see what we're working with, we can `console.log` the `config` here. Then `//` out the `return`, which will help the webpack process and let us see the config. 

```js
/* config-overrides.js */

module.exports = function override(config, env) {
  console.log("config: ", config)

  // return config;
}
```

Next open `package.json` in the root of the project and replace the default react-script-calls with `react-app-rewired` for `start`, `build`, and `test`.

#### package.json
```json
"scripts": {
  "start": "react-app-rewired start",
  "build": "react-app-rewired build",
  "test": "react-app-rewired test",
  "eject": "react-scripts eject"
},
```

Now let's make a production `yarn build`, which shows us the config that we're working with, and then stops the build process. 

#### terminal
```bash
$ yarn build
```

![image of the terminal output from the production build](https://res.cloudinary.com/dg3gyk0gu/image/upload/v1544582335/transcript-images/react-use-a-custom-service-worker-in-a-create-react-app-pwa-without-ejecting-terminal.png)

The basic service worker is currently being generated by this Generate SW plugin. That's the plugin that we want to replace with a more fully featured Workbox plugin.

In `config-overides.js` we can import `WorkboxWebpackPlugin`, and then `.map` over all the `plugins`. When we get to the `GenerateSW` plugin, we'll replace it with `InjectManifest` from Workbox. We can name the source whatever we'd like. We'll call that `sw.js` and put it in the `src` folder. The destination has to match what we have in `serviceworker.js`. We'll call that `'service-worker.js'`.


#### config.overrides.js
```js
/* config-overrides.js */

const WorkboxWebpackPlugin = require('workbox-webpack-plugin')

module.exports = function override(config, env) {
  config.plugins = config.plugins.map(plugin => {
    if(plugin.constructor.name === 'GenerateSW') {
      return new WorkboxWebpackPlugin.InjectManifest({
        swSrc: './src/sw.js',
        swDest: 'service-worker.js'
      })
    }

    return plugin
  })

  return config
}
```

Now we can make the new `sw.js` file in `src`. Here we can define our custom service worker. As for the `console.log` like before, but we can also use all the power of `Workbox`. For this example, we'll call `skipWaiting` and `clientsClaim`, which will ensure our service worker gets installed on all the open clients right away.

```js
console.log("In sw.js")

workbox.skipWaiting()
workbox.clientsClaim()
```

If your service worker is complex you probably don't want these two lines, but they're useful for this demo. Finally, we can `yarn build` a new build and `serve -s build` it. 

#### terminal
```bash
$ yarn build
```
```bash
$ serve -s build
```

Then open a new tab and navigate to it in Chrome. 

![image of the application opened in chrome](https://res.cloudinary.com/dg3gyk0gu/image/upload/v1544582328/transcript-images/react-use-a-custom-service-worker-in-a-create-react-app-pwa-without-ejecting-finalbuild.png)

In the console we see our message. 

![image of the message in the console tab](https://res.cloudinary.com/dg3gyk0gu/image/upload/v1544582328/transcript-images/react-use-a-custom-service-worker-in-a-create-react-app-pwa-without-ejecting-buildconsole.png)

Then in the application tab we can see the generated service worker code and we can see that Workbox is properly setup and working.

![image of the generated service worker code in the app tab](https://res.cloudinary.com/dg3gyk0gu/image/upload/v1544582335/transcript-images/react-use-a-custom-service-worker-in-a-create-react-app-pwa-without-ejecting-buildapp.png)
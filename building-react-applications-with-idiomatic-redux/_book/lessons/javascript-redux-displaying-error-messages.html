
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>Displaying Error Messages Â· GitBook</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.0">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="javascript-redux-creating-data-on-the-server.html" />
    
    
    <link rel="prev" href="javascript-redux-adding-a-fake-backend-to-the-project.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="javascript-redux-simplifying-the-arrow-functions.html">
            
                <a href="javascript-redux-simplifying-the-arrow-functions.html">
            
                    
                    Simplifying the Arrow Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="javascript-redux-supplying-the-initial-state.html">
            
                <a href="javascript-redux-supplying-the-initial-state.html">
            
                    
                    Supplying the Initial State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="javascript-redux-persisting-the-state-to-the-local-storage.html">
            
                <a href="javascript-redux-persisting-the-state-to-the-local-storage.html">
            
                    
                    Persisting the State to the Local Storage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="javascript-redux-refactoring-the-entry-point.html">
            
                <a href="javascript-redux-refactoring-the-entry-point.html">
            
                    
                    Refactoring the Entry Point
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="javascript-redux-adding-react-router-to-the-project.html">
            
                <a href="javascript-redux-adding-react-router-to-the-project.html">
            
                    
                    Adding React Router to the Project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="javascript-redux-navigating-with-react-router-link.html">
            
                <a href="javascript-redux-navigating-with-react-router-link.html">
            
                    
                    Navigating with React Router 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="javascript-redux-filtering-redux-state-with-react-router-params.html">
            
                <a href="javascript-redux-filtering-redux-state-with-react-router-params.html">
            
                    
                    Filtering Redux State with React Router Params
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="javascript-redux-using-withrouter-to-inject-the-params-into-connected-components.html">
            
                <a href="javascript-redux-using-withrouter-to-inject-the-params-into-connected-components.html">
            
                    
                    Using withRouter() to Inject the Params into Connected Components
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="javascript-redux-using-mapdispatchtoprops-shorthand-notation.html">
            
                <a href="javascript-redux-using-mapdispatchtoprops-shorthand-notation.html">
            
                    
                    Using mapDispatchToProps() Shorthand Notation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="javascript-redux-colocating-selectors-with-reducers.html">
            
                <a href="javascript-redux-colocating-selectors-with-reducers.html">
            
                    
                    Colocating Selectors with Reducers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="javascript-redux-normalizing-the-state-shape.html">
            
                <a href="javascript-redux-normalizing-the-state-shape.html">
            
                    
                    Normalizing the State Shape
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="javascript-redux-wrapping-dispatch-to-log-actions.html">
            
                <a href="javascript-redux-wrapping-dispatch-to-log-actions.html">
            
                    
                    Wrapping dispatch() to Log Actions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="javascript-redux-adding-a-fake-backend-to-the-project.html">
            
                <a href="javascript-redux-adding-a-fake-backend-to-the-project.html">
            
                    
                    Adding a Fake Backend to the Project
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.15" data-path="javascript-redux-displaying-error-messages.html">
            
                <a href="javascript-redux-displaying-error-messages.html">
            
                    
                    Displaying Error Messages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="javascript-redux-creating-data-on-the-server.html">
            
                <a href="javascript-redux-creating-data-on-the-server.html">
            
                    
                    Creating Data on the Server
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Displaying Error Messages</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>Sometimes API requests fail, and I will simulate this by throwing inside the fake API client so that it returns a reject promise. If I run the app the loading indicator gets stuck because <code>isFetching</code> and flag get set to two, but there is no corresponding <code>RECEIVE_TODOS</code> action to set it to falls back again.</p><p><img alt="console output" src="../images/javascript-redux-displaying-error-messages-output.png"></p><p>To fix this, I will start with the action creators file. First of all, I&apos;ll do a little cleanup. The <code>REQUEST_TODOS</code> action is never used outside of <code>fetchTodos</code> so I want to embed the object literal right inside fetch todos for clarity.</p><p><strong>actions/index.js</strong></p><pre><code class="lang-javascript">dispatch({
  type: <span class="hljs-string">`REQUEST_TODOS`</span>,
  filter,
});</code></pre>
<p>I will do the same for <code>RECEIVE_TODOS</code>. I will copy the ofbject literal for the <code>REVEIVE_TODOS</code> action and paste it where I dispatch it inside <code>fetchTodos</code> so it&apos;s easier to see the flow of <code>fetchTodos</code> action. I want to tweak the indentation a little bit to prepare for adding the second argument to promise.then method, the rejection handler.</p><p><strong>actions/index.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">return</span> api.fetchTodos(filter).then(
  response =&gt; {
    dispatch({
      type: <span class="hljs-string">&apos;RECEIVE_TODOS&apos;</span>,
      filter,
      response,
    });
  },
  error =&gt; {

  };
);</code></pre>
<p>Now that the <code>fetchTodos</code> <strong>action creator</strong> dispatches quite a bit of actions, I want to rename them to a consistent naming scheme such as <code>FETCH_TODOS_REQUEST</code>, for requesting the todos, <code>FETCH_TODOS_SUCCESS</code>, for successful fetching the todos and <code>FETCH_TODO_FAILURE</code> for failing to fetch the todos.</p><p>I will pass two additional pieces of data, the <code>filter</code> and the error message, that I get the reading the error message field if specified or something went wrong as a fallback. The <code>fetchTodos</code> action creator now handles all the cases.</p><p><strong>actions/index.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> fetchTodos = (filter) =&gt; (dispatch, getState) =&gt; {
  <span class="hljs-keyword">if</span> (getIsFetching(getState(), filter)) {...}

  dispatch({...})

  <span class="hljs-keyword">return</span> api.fetchTodos(filter).then(
    response =&gt; {...},
    error =&gt; {
      dispatch({
        type: <span class="hljs-string">&apos;FETCH_TODOS_FAILURE&apos;</span>,
        filter,
        message: error.message || <span class="hljs-string">&apos;Something went wrong.&apos;</span>,
      });
    }
  );
};</code></pre>
<p>I can also remove the old action creators that I have aligned into it. If I change the action types, I also need to change the corresponding reducers so I&apos;m opening the <code>ids</code> reducer and rather than handle  it now needs to handle <code>FETCH_TODOS_SUCCESS</code>.</p><p><strong>createList.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">const</span> createList = (filter) =&gt; {
  <span class="hljs-keyword">const</span> ids = (state = [], action) =&gt; {
    <span class="hljs-keyword">if</span> (filter !== action.filter) {
      <span class="hljs-keyword">return</span> state;
    }
    <span class="hljs-keyword">switch</span> (action.type) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;FETCH_TODOS_SUCCESS&apos;</span>:
        <span class="hljs-keyword">return</span> action.response.map(todo =&gt; todo.id);
      <span class="hljs-keyword">default</span>:
        <span class="hljs-keyword">return</span> state;
    }
  };</code></pre>
<p>I also need to change the <code>isFetching</code> reducer. I&apos;m renaming the <code>REQUEST_TODOS</code> the <code>FETCH_TODOS_REQUEST</code> and <code>RECEIVE_TODOS</code>, <code>FETCH_TODOS_SUCCESS</code> I also want to handle <code>FETCH_TODOS_FAILURE</code> and return <code>false</code> so that the loading indicator doesn&apos;t get stuck.</p><p><strong>createList.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">const</span> isFetching = (state = <span class="hljs-literal">false</span>, action) =&gt; {
  <span class="hljs-keyword">if</span> (filter !== action.filter) {
    <span class="hljs-keyword">return</span> state;
  }
  <span class="hljs-keyword">switch</span> (action.type) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;FETCH_TODOS_REQUEST&apos;</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;FETCH_TODOS_SUCCESS&apos;</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;FETCH_TODOS_FAILURE&apos;</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">return</span> state;
  }
};</code></pre>
<p>The last reducer I need to change is <code>byId</code>, and I just replace <code>RECEIVE_TODOS</code> with <code>FETCH_TODO_SUCCESS</code>.</p><p><strong>byId</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">const</span> byId = (state = {}, action) =&gt; {
  <span class="hljs-keyword">switch</span> (action.type) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;FETCH_TODOS_SUCCESS&apos;</span>: <span class="hljs-comment">// eslint-disable-line no-case-declarations</span>
      <span class="hljs-keyword">const</span> nextState = { ...state };
      action.response.forEach(todo =&gt; {
        nextState[todo.id] = todo;
      });</code></pre>
<p>If I run the app now the loading indicator does not get stuck, because a corresponding failure action fires and so isFetching gets reset back to false again.</p><p><img alt="console output two" src="../images/javascript-redux-displaying-error-messages-output2.png"></p><p>Let&apos;s display the error to the user. I have created a new file where I import react. I&apos;m declaring a new functional stateless component called <code>FetchError</code> that takes the <code>message</code> as a prop, which is a string, and <code>onRetry</code> as a prop, which is a function.</p><p><strong>FetchError</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;

<span class="hljs-keyword">const</span> FetchError = ({ message, onRetry }) =&gt; (

);</code></pre>
<p>The render deep will contain the children, an error saying that something bad happened including the <code>message</code> that is passed in the props, and a button that when clicked will invoke the <code>onRetry</code> callback prop so that the user can retry fetching the data.</p><p><strong>FetchError</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;

<span class="hljs-keyword">const</span> FetchError = ({ message, onRetry }) =&gt; (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Could not fetch todos. {message}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onRetry}</span>&gt;</span>Retry<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
);</code></pre>
<p>I am exporting this component as a default export from <code>FetchError</code>, and I&apos;m going to the <code>visibleTodoList</code> where I want to use it. I&apos;m adding <code>FetchError</code> as an <strong>import</strong> to the <code>visibleTodoList</code>, and I&apos;m scrolling down to the <code>render</code> method.</p><p>I will need the error message which I&apos;m de-structuring from the props of <code>visibleTodoList</code> component, and inside the <code>render</code> method I will add another condition saying that if we have an error message in our props and we have no todos to display then I&apos;m going to return the <code>FetchError</code> component.</p><p><strong>visibleTodoList.js</strong></p><pre><code class="lang-javascript">render() {
  <span class="hljs-keyword">const</span> { isFetching, errorMessage, toggleTodo, todos } = <span class="hljs-keyword">this</span>.props;
  <span class="hljs-keyword">if</span> (isFetching &amp;&amp; !todos.length) {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
  }
  <span class="hljs-keyword">if</span> (errorMessage &amp;&amp; !todos.length) {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">FetchError</span>/&gt;</span></span>
    );
  }</code></pre>
<p>The <code>FetchError</code> component itself wants a <code>message</code> prop which I can pass the <code>errorMessage</code> prop I just de-structured and an <code>onRetry</code> callback prop for which I will pass an <strong>arrow function</strong> that calls this <code>this.fetchData</code> to restart the data fetching process.</p><p><strong>visibleTodoList</strong></p><pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">FetchError</span>
  <span class="hljs-attr">message</span>=<span class="hljs-string">{errorMessage}</span>
  <span class="hljs-attr">onRetry</span>=<span class="hljs-string">{()</span> =&gt;</span> this.fetchData()}
/&gt;</code></pre>
<p>In order to get the error message into the props I&apos;ll need to scroll down to my <code>mapStateToProps</code> implementation and put it there. I will use the same pattern as I currently do with <code>isFetching</code>, and I will get the error message prop by calling a selector called <code>getErrorMessage</code> passing the state of the app and the filter.</p><p><strong>VisibleTodoList</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">const</span> mapStateToProps = (state, { params }) =&gt; {
  <span class="hljs-keyword">const</span> filter = params.filter || <span class="hljs-string">&apos;all&apos;</span>;
  <span class="hljs-keyword">return</span> {
    isFetching: getIsFetching(state, filter),
    errorMessage: getErrorMessage(state, filter),
    todos: getVisibleTodos(state, filter),
    filter,
  };
};</code></pre>
<p>The <code>getErrorMessage</code> selector does not exist yet so I need to scroll up to where I import the selectors from the root reducers file, and I will add <code>getErrorMessage</code> alongside <code>getIsFetching</code>. Inside the root reducers file I&apos;m copy/paste in the <code>getIsFetching</code> selector, and I&apos;m changing the name to get error message. It will also delegate to a selector with a same name defined in the createList.js.</p><p><strong>reducers/index.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getIsFetching = (state, filter) =&gt;
  fromList.getIsFetching(state.listByFilter[filter]);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getErrorMessage = (state, filter) =&gt;
  fromList.getErrorMessage(state.listByFilter[filter]);</code></pre>
<p>Inside createList.js, I&apos;m adding a new exported selector called <code>getErrorMessage</code> that takes the state of the list and returns a property called <code>errorMessage</code>. Finally, I need to add a reducer managing the <code>errorMessage</code> field which I will add to the <code>combinedReducers</code> later.</p><p><strong>createList.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getErrorMessage = (state) =&gt; state.errorMessage;</code></pre>
<p>I&apos;m declaring a new reducer called <code>errorMessage</code> with the initial state of <code>null</code>. <strong>A reducer cannot have undefined initial state</strong> so I have to make its absence explicit. Like in the other reducers in this file, I want to skip any actions with the filter that doesn&apos;t match the filter specified as an argument to <code>createList</code>.</p><p><strong>createList.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">const</span> errorMessage = (state = <span class="hljs-literal">null</span>, action) =&gt; {
  <span class="hljs-keyword">if</span> (filter !== action.filter) {
    <span class="hljs-keyword">return</span> state;
  }
};</code></pre>
<p>When the filter matches, I want to handle a few actions. I would like to display an error message whenever I get a failure so I handle a <code>FETCH_TODOS_FAILURE</code> by returning the message embedded the action.</p><p><strong>createList.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">const</span> errorMessage = (state = <span class="hljs-literal">null</span>, action) =&gt; {
  <span class="hljs-keyword">if</span> (filter !== action.filter) {...}
  <span class="hljs-keyword">switch</span> (action.type) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;FETCH_TODOS_FAILURE&apos;</span>:
      <span class="hljs-keyword">return</span> action.message;
  }
};</code></pre>
<p>If the user retries a request I want to clear the error message so I handle a fetch <code>FETCH_TODOS_REQUEST</code> and <code>FETCH_TODOS_SUCCESS</code> by returning <code>null</code>. Finally, for any other action, I&apos;ll just return the current state. The <code>errorMessage</code> reducer needs to be added to the <code>combineReducers</code> for the list so that its state becomes available on the <code>listState</code> object.</p><p><strong>createList.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">const</span> errorMessage = (state = <span class="hljs-literal">null</span>, action) =&gt; {
  <span class="hljs-keyword">if</span> (filter !== action.filter) {...}
  <span class="hljs-keyword">switch</span> (action.type) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;FETCH_TODOS_FAILURE&apos;</span>:
      <span class="hljs-keyword">return</span> action.message;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;FETCH_TODOS_REQUEST&apos;</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;FETCH_TODOS_SUCCESS&apos;</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">return</span> state; 
  }
};

<span class="hljs-keyword">return</span> combineReducers({
  ids,
  isFetching,
  errorMessage,
});</code></pre>
<p>Now I will change my API layer so it doesn&apos;t throw every time. This way I&apos;ll get a chance to test how well the retry button works. If I run the app now, I can see the failure action being omitted with the corresponding message.</p><p><strong>api/index.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> fetchTodos = (filter) =&gt; 
  delay(<span class="hljs-number">500</span>).then(() =&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Math</span>.random() &gt; <span class="hljs-number">0.5</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&apos;Boom!&apos;</span>);
    }</code></pre>
<p><img alt="FETCH_TODOS_FAILURE" src="../images/javascript-redux-displaying-error-messages-output3.png"></p><p>Thanks to the new reducer, this message will now make its way into the next state inside <code>listByFilter</code>, <code>all</code>, <code>errorMessage</code> and so the component can display it. If I press the retry button, the request action will clear the error message and then the success action will populate the list of todos.</p><p><img alt="FETCH_TODOS_SUCCESS" src="../images/javascript-redux-displaying-error-messages-output4.png"></p><p>Let&apos;s recap how we handle errors for every list independently. Inside the fake API client, I randomly throw an error so <code>fetchTodos</code> returns a rejected promise once in a while. Having separate action creators for request success and failure cases seemed like overkill. I in-lined the corresponding action objects right inside the async action creator.</p><p><strong>actions/index.js</strong></p><pre><code class="lang-javascript">dispatch({
  type: <span class="hljs-string">&apos;FETCH_TODOS_REQUEST&apos;</span>,
  filter,
});

<span class="hljs-keyword">return</span> api.fetchTodos(filter).then(
  response =&gt; {
    dispatch({
      type: <span class="hljs-string">&apos;FETCH_TODOS_SUCCESS&apos;</span>,
      filter,
      response,
    });
  },</code></pre>
<p>I also renamed them to <code>FETCH_TODOS_REQUEST</code>, <code>FETCH_TODOS_SUCCESS</code>, and I added a new <code>FETCH_TODOS_FAILURE</code> action so that we can reset the loading indicator and display the error message.</p><p><strong>actions/index.js</strong></p><pre><code class="lang-javascript">error =&gt; {
  dispatch({
    type: <span class="hljs-string">&apos;FETCH_TODOS_FAILURE&apos;</span>,
    filter,
    message: error.message || <span class="hljs-string">&apos;Something went wrong.&apos;</span>,
  });
}</code></pre>
<p>I am passing the rejection handler as a second argument to the <code>promise.then</code> method. If the promise returned by the API gets rejected, this function will be called with the error as the argument.</p><p>You might have seen a different way of handling promise errors in some examples where only one argument is passed and then you call catch on the resulting promise. The downside of this approach is if one of your reducers or subscribe components throws while handling this action you&apos;ll get into the catch block and so you&apos;ll display an internal error message to the user.</p><p><strong>actions/index.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">return</span> api.fetchTodos(filter).then(
  response =&gt; {
    dispatch({
      type: <span class="hljs-string">&apos;FETCH_TODOS_SUCCESS&apos;</span>,
      filter,
      response,
    });
  },
).catch(
  error =&gt; {
    dispatch({
      type: <span class="hljs-string">&apos;FETCH_TODOS_FAILURE&apos;</span>,
      filter,
      message: error.message || <span class="hljs-string">&apos;Something went wrong.&apos;</span>,
    });
  }
)</code></pre>
<p>To avoid this error, I recommend that you don&apos;t use <code>catch</code> in this scenario and just pass the second argument so it catches only the errors from the underlying API promise. The <code>error</code> object usually comes with a message that we can wrap or display directly to the user with a fallback.</p><p><strong>actions/index.js</strong></p><pre><code class="lang-javascript">error =&gt; {
  dispatch({
    type: <span class="hljs-string">&apos;FETCH_TODOS_FAILURE&apos;</span>,
    filter,
    message: error.message || <span class="hljs-string">&apos;Something went wrong.&apos;</span>,
  });
}</code></pre>
<p>We make it available to the reducers as the <code>message</code> field on the action object. I renamed the action types so I also needed to update the reducer inside byId.js and the reducers inside createList.js to use the new names.</p><p><strong>byId.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">const</span> byId = (state = {}, action) =&gt; {
  <span class="hljs-keyword">switch</span> (action.type) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;FETCH_TODOS_SUCCESS&apos;</span>: <span class="hljs-comment">// eslint-disable-line no-case-declarations</span></code></pre>
<p><strong>createList.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">const</span> createList = (filter) =&gt; {
  <span class="hljs-keyword">const</span> ids = (state = [], action) =&gt; {
    <span class="hljs-keyword">if</span> (filter !== action.filter) {
      <span class="hljs-keyword">return</span> state;
    }
    <span class="hljs-keyword">switch</span> (action.type) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;FETCH_TODOS_SUCCESS&apos;</span>:</code></pre>
<p>We only want to update the IDs on a successful fetch. However, we want to update the indicator in all three cases. In particular, I reset the loading indicator both on success and on failure. I also added a new reducer that keeps track of the error message for the given tab.</p><p><strong>createList.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">const</span> isFetching = (state = <span class="hljs-literal">false</span>, action) =&gt; {
  <span class="hljs-keyword">if</span> (filter !== action.filter) {
    <span class="hljs-keyword">return</span> state;
  }
  <span class="hljs-keyword">switch</span> (action.type) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;FETCH_TODOS_REQUEST&apos;</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;FETCH_TODOS_SUCCESS&apos;</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;FETCH_TODOS_FAILURE&apos;</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">return</span> state;
  }
};


<span class="hljs-keyword">const</span> errorMessage = (state = <span class="hljs-literal">null</span>, action) =&gt; {...}


When the request fails, its state becomes the message <span class="hljs-keyword">from</span> the action. But <span class="hljs-keyword">if</span> it succeeds or <span class="hljs-keyword">if</span> a <span class="hljs-keyword">new</span> request starts, it is reset to <span class="hljs-string">`null`</span>. Like <span class="hljs-keyword">in</span> other reducers <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span> file, we are only handling actions that have the same filter <span class="hljs-keyword">as</span> the filter <span class="hljs-keyword">this</span> list was created <span class="hljs-keyword">with</span>.

**createList**
<span class="hljs-string">``</span><span class="hljs-string">`javascript
const errorMessage = (state = null, action) =&gt; {
  if (filter !== action.filter) {
    return state;
  }
  switch (action.type) {
    case &apos;FETCH_TODOS_FAILURE&apos;:
      return action.message;
    case &apos;FETCH_TODOS_REQUEST&apos;:
    case &apos;FETCH_TODOS_SUCCESS&apos;:
      return null;
    default:
      return state;
  }
};</span></code></pre>
<p>The <code>return combineReducers</code> now manages both <code>isFetching</code> and the currently displayed error message. This lets me add a new selected called <code>getErrorMessage</code> that just reads the error message field from the combined state object.</p><p><strong>createList.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getErrorMessage = (state) =&gt; state.errorMessage;</code></pre>
<p>I&apos;m calling this selector from the top level reducer file, and I&apos;m passing the slice of the state corresponding to the list for the specified filter. The top level <code>getErrorMessage</code> selector will be called inside <code>mapStateToProps</code> of the <code>visibleTodoList</code> component.</p><p><strong>reducers/index.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getErrorMessage = (state, filter) =&gt;
  fromList.getErrorMessage(state.listByFilter[filter]);</code></pre>
<p>It receives the global state and the current filter as arguments, and the result will be available as <code>errorMessage</code> prop inside the <code>visibleTodoList</code> components render function.</p><p><strong>VisibleTodoList.js</strong></p><pre><code class="lang-javascript">cosnt mapStateToProps = (state, { params }) =&gt; {
  <span class="hljs-keyword">const</span> filter = params.filter || <span class="hljs-string">&apos;all&apos;</span>;
  <span class="hljs-keyword">return</span> {
    isFetching: getIsFetching(state, filter),
    errorMessage: getErrorMessage(state, filter),
    todos: getVisibleTodos(state, filter),
    filter,
  };
};</code></pre>
<p>I&apos;m de-structuring the <code>errorMessage</code> from the props, and if I have an <code>errorMessage</code> and no todo list to show I will render the <code>FetchError</code> component passing the <code>errorMessage</code> and a function that refetches the data as the props.</p><p><strong>VisibleTodoList.js</strong></p><pre><code class="lang-javascript">render() {
  <span class="hljs-keyword">const</span> { isFetching, errorMessage, toggleTodo, todos } = <span class="hljs-keyword">this</span>.props;
  <span class="hljs-keyword">if</span> (isFetching &amp;&amp; !todos.length) {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
  }
  <span class="hljs-keyword">if</span> (errorMessage &amp;&amp; !todos.length) {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">FetchError</span>
        <span class="hljs-attr">message</span>=<span class="hljs-string">{errorMessage}</span>
        <span class="hljs-attr">onRetry</span>=<span class="hljs-string">{()</span> =&gt;</span> this.fetchData()}
      /&gt;
    );
  }</span></code></pre>
<p>Finally, I created a new component called <code>FetchError</code> that displays the message from the props and renders a button that lets the user retry the fetch action.</p><p><strong>FetchError.js</strong></p><pre><code class="lang-javascript"><span class="hljs-keyword">const</span> FetchError = ({ message, onRetry }) =&gt; (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Could not fetch todos. {message}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onRetry}</span>&gt;</span>Retry<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
);</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="javascript-redux-adding-a-fake-backend-to-the-project.html" class="navigation navigation-prev " aria-label="Previous page: Adding a Fake Backend to the Project">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="javascript-redux-creating-data-on-the-server.html" class="navigation navigation-next " aria-label="Next page: Creating Data on the Server">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Displaying Error Messages","level":"1.15","depth":1,"next":{"title":"Creating Data on the Server","level":"1.16","depth":1,"path":"lessons/javascript-redux-creating-data-on-the-server.md","ref":"./lessons/javascript-redux-creating-data-on-the-server.md","articles":[]},"previous":{"title":"Adding a Fake Backend to the Project","level":"1.14","depth":1,"path":"lessons/javascript-redux-adding-a-fake-backend-to-the-project.md","ref":"./lessons/javascript-redux-adding-a-fake-backend-to-the-project.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"lessons/javascript-redux-displaying-error-messages.md","mtime":"2016-08-26T20:17:33.000Z","type":"markdown"},"gitbook":{"version":"3.2.0","time":"2016-08-24T21:28:02.324Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

